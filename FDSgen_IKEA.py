# -*- coding: utf-8 -*-
"""
This routine writes a basic input to run FDS (Fire Dynamics Simulator) and 
saves it as a .fds file.

Created on Sat Nov 28 17:00:00 2020

@author: Sebastian Aedo
"""

from FDSpy.writeINPUT import write

# =============================================================================
# Parámetros generales
# =============================================================================
fname = 'IKEA'
dirname = 'C:/Users/Sebastian Aedo/Desktop/testeo_IKEA/'

title = 'Malla preliminar'
t0 = 0 #seconds
tf = 0 #seconds

# =============================================================================
# Geometría general
# =============================================================================
## Mesh properties
dx = 0.5
dlosa = 0.1

x0_1 = 0
x1_1 = 52
y0_1 = 0
y1_1 = 106
z0_1 = 0
z1_1 = 10

x0_2 = 0
x1_2 = 114
y0_2 = 0
y1_2 = 106
z0_2 = z1_1
z1_2 = z1_1+10

nx_1 = int((x1_1 - x0_1)/dx)
ny_1 = int((y1_1 - y0_1)/dx)
nz_1 = int((z1_1 - z0_1)/dx)

nx_2 = int((x1_2 - x0_2)/dx)
ny_2 = int((y1_2 - y0_2)/dx)
nz_2 = int((z1_2 - z0_2)/dx)


mesh = [[[x0_1,x1_1,y0_1,y1_1,z0_1,z1_1],[nx_1,ny_1,nz_1]],
        [[x0_2,x1_2,y0_2,y1_2,z0_2,z1_2],[nx_2,ny_2,nz_2]]] # meters - n

# =============================================================================
# Materials and surfaces
# =============================================================================
## Materials
matl_id = ['MALT_ID','CONDUCTIVITY','SPECIFIC_HEAT','DENSITY']
matl = [['CONCRETE',1.0,0.88,2100],
        ['CARPET',1.0,0.88,2100]]

## Surfaces
surf_id = ['SURF_ID','MATL_ID','COLOR','HRRPUA','THICKNESS']
surf = [['FIRE','','RED',2500,''], #Fire
        ['WALL','CONCRETE','GRAY','',0.1], #Walls in the domain
        ['FLOOR','CARPET','BROWN','',0.1], #Floor in the domain
        ['BOUNDARY','CONCRETE','KHAKI','',0.1], #Floor boundary
        ['OPEN','','WHITE',0,0]]

# =============================================================================
# Obstructions, holes and vents
# =============================================================================
obst = [[[18,18,0,13,z0_1,z1_1],3], #O1_1
        [[6,18,13,13,z0_1,z1_1],3], #O2_1
        [[0,0,19,y1_1,z0_1,z1_1],3], #04_1
        [[0,6.8,y1_1,y1_1,z0_1,z1_1],3], #05_1
        [[6.8,6.8,98.9,y1_1,z0_1,z1_1],3], #O6_1
        [[18.1,24.3,81.9,81.9,z0_1,z1_1],3], #O10_1
        [[39.4,x1_1,94.8,94.8,z0_1,z1_1],3], #O12_1
        [[x1_1,x1_1,0,94.8,z0_1,z1_1],3], #O13_1
        [[18,x1_1,0,0,z0_1,z1_1],3], #O14_1
        [[27.2,27.2,0,13,z0_1,z1_1],1], #W1_1
        [[18,27.2,13,13,z0_1,z1_1],1], #W2_1
        [[0,29.9,37,39.1,z0_1,z1_1],1], #W3_1
        [[0,24.3,75.4,75.4,z0_1,z1_1],1], #W4_1
        [[24.3,24.3,75.4,81.9,z0_1,z1_1],1], #W5_1
        [[24.3,x1_1,81.9,81.9,z0_1,z1_1],1], #W6_1       
        [[x0_1,x1_2,y0_1,y1_1,z1_1-dlosa,z1_1+dlosa],1],
        [[20.6,20.6,3.5,21.3,z0_2,z1_2],3], #O1_2
        [[2.1,20.6,21.3,21.3,z0_2,z1_2],3], #O2_2
        [[2.1,2.1,21.3,73.1,z0_2,z1_2],3], #O3_2
        [[2.1,3.6,73.1,73.1,z0_2,z1_2],3], #O4_2
        [[3.6,3.6,73.1,81.5,z0_2,z1_2],3], #O5_2
        [[0,3.6,81.5,81.5,z0_2,z1_2],3], #O6_2
        [[0,0,81.5,y1_2,z0_2,z1_2],3], #O7_2
        [[0,6.8,y1_2,y1_2,z0_2,z1_2],3], #O8_2
        [[6.8,6.8,98.9,y1_1,z0_2,z1_2],3], #O9_2
        [[10.2,x1_2,97.6,97.6,z0_2,z1_2],3], #O11_2
        [[x1_2,x1_2,24.6,97.6,z0_2,z1_2],3], #O12_2
        [[101.9,x1_2,24.6,24.6,z0_2,z1_2],3], #O13_2
        [[101.9,101.9,18.6,24.6,z0_2,z1_2],3], #O14_2
        [[89.5,101.9,18.6,18.6,z0_2,z1_2],3], #O15_2
        [[89.5,89.5,12.2,18.6,z0_2,z1_2],3], #O16_2
        [[62.1,89.5,12.2,12.2,z0_2,z1_2],3], #O17_2
        [[20.6,54,3.5,3.5,z0_2,z1_2],3], #O20_2
        [[20.6,23.6,17.5,17.5,z0_2,z1_2],1], #W1_2
        [[23.6,23.6,17.5,55.3,z0_2,z1_2],1], #W2_2        
        [[23.6,29.6,55.3,55.3,z0_2,z1_2],1], #W3_2
        [[29.6,29.6,55.3,97.6,z0_2,z1_2],1], #W4_2        
        [[48.2,48.2,36.5,46.5,z0_2,z1_2],1], #W5_2
        [[44.6,54,46.5,46.5,z0_2,z1_2],1], #W6_2
        [[44.6,44.6,46.5,64.3,z0_2,z1_2],1], #W7_2
        [[66,66,34.6,51.2,z0_2,z1_2],1], #W8_2
        [[66,85.4,44.6,51.2,z0_2,z1_2],1], #W9_2
        [[85.4,108.8,48.8,51.2,z0_2,z1_2],1], #W10_2
        [[108.8,x1_2,44.6,58.5,z0_2,z1_2],1]] #W11_2


diag = [[0,6,19,13,z0_1,z1_1,nz_1,3], #O3_1
        [11.9,18.1,87.2,81.9,z0_1,z1_1,nz_1,3], #O7_1
        [11.9,15.6,87.2,91.5,z0_1,z1_1,nz_1,3], #O8_1
        [6.8,15.6,98.9,91.5,z0_1,z1_1,nz_1,3], #O9_1
        [27.2,39.4,81.9,94.8,z0_1,z1_1,nz_1,3], #O11_1
        [6.8,11,98.9,97.6,z0_2,z1_2,nz_1,3], #O10_2
        [54,60.6,3.5,5.5,z0_2,z1_2,nz_1,3], #O18_2
        [60.6,62.1,5.5,12.2,z0_2,z1_2,nz_1,3]] #O19_2

hole = [[39.2,52,19.3,36.5,z1_1-dlosa*1.1,z1_1+dlosa*1.1]]

vent = [[[0,1,36,37,0,0],4]]

# =============================================================================
# Write file
# =============================================================================
FDS_input = dirname,fname,title,t0,tf,mesh,matl,matl_id,surf,surf_id,obst,diag,vent,hole,False

write(FDS_input)


nx_1 = (x1_1 - x0_1)/dx
ny_1 = (y1_1 - y0_1)/dx
nz_1 = (z1_1 - z0_1)/dx

nx_2 = (x1_2 - x0_2)/dx
ny_2 = (y1_2 - y0_2)/dx
nz_2 = (z1_2 - z0_2)/dx

if int(nx_1)==nx_1 and int(ny_1)==ny_1 and int(nz_1)==nz_1:
    if int(nx_2)==nx_2 and int(ny_2)==ny_2 and int(nz_2)==nz_2:
        nx_1 = int(nx_1) ; ny_1 = int(ny_1) ; nz_1 = int(nz_1)
        nx_2 = int(nx_2) ; ny_2 = int(ny_2) ; nz_2 = int(nz_2)
        print('Input file writen succesfully')
    else:
        print('Error: Second floor discretization does not match')
else:
    print('Error: First floor discretization does not match')